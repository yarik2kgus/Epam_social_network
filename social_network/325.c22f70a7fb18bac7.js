(self.webpackChunksocial_network=self.webpackChunksocial_network||[]).push([[325],{8325:(Ke,Ae,A)=>{"use strict";A.r(Ae),A.d(Ae,{default:()=>G});var $=A(6814),w=A(5861),o=A(5678),Je=A(6593),E=A(3019),se=A(2438),$e=A(9773),et=A(1374);const ee=["wrapper"],X=["sourceImage"];function Te(h,g){if(1&h){const e=o.EpF();o.TgZ(0,"img",4,5),o.NdJ("load",function(){o.CHM(e);const n=o.oxw();return o.KtG(n.imageLoadedInView())})("mousedown",function(n){o.CHM(e);const s=o.oxw();return o.KtG(s.startMove(n,s.moveTypes.Drag))})("touchstart",function(n){o.CHM(e);const s=o.oxw();return o.KtG(s.startMove(n,s.moveTypes.Drag))})("error",function(n){o.CHM(e);const s=o.oxw();return o.KtG(s.loadImageError(n))}),o.qZA()}if(2&h){const e=o.oxw();o.Udp("visibility",e.imageVisible?"visible":"hidden")("transform",e.safeTransformStyle),o.ekj("ngx-ic-draggable",!e.disabled&&e.allowMoveImage),o.Q6J("src",e.safeImgDataUrl,o.LSH),o.uIk("alt",e.imageAltText)}}function we(h,g){if(1&h){const e=o.EpF();o.ynx(0),o.TgZ(1,"span",9),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"topleft"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"topleft"))}),o._UZ(2,"span",10),o.qZA(),o.TgZ(3,"span",11),o._UZ(4,"span",10),o.qZA(),o.TgZ(5,"span",12),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"topright"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"topright"))}),o._UZ(6,"span",10),o.qZA(),o.TgZ(7,"span",13),o._UZ(8,"span",10),o.qZA(),o.TgZ(9,"span",14),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"bottomright"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"bottomright"))}),o._UZ(10,"span",10),o.qZA(),o.TgZ(11,"span",15),o._UZ(12,"span",10),o.qZA(),o.TgZ(13,"span",16),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"bottomleft"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"bottomleft"))}),o._UZ(14,"span",10),o.qZA(),o.TgZ(15,"span",17),o._UZ(16,"span",10),o.qZA(),o.TgZ(17,"span",18),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"top"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"top"))}),o.qZA(),o.TgZ(18,"span",19),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"right"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"right"))}),o.qZA(),o.TgZ(19,"span",20),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"bottom"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"bottom"))}),o.qZA(),o.TgZ(20,"span",21),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"left"))})("touchstart",function(n){o.CHM(e);const s=o.oxw(2);return o.KtG(s.startMove(n,s.moveTypes.Resize,"left"))}),o.qZA(),o.BQk()}}function te(h,g){if(1&h){const e=o.EpF();o.TgZ(0,"div",6),o.NdJ("keydown",function(n){o.CHM(e);const s=o.oxw();return o.KtG(s.keyboardAccess(n))}),o.TgZ(1,"div",7),o.NdJ("mousedown",function(n){o.CHM(e);const s=o.oxw();return o.KtG(s.startMove(n,s.moveTypes.Move))})("touchstart",function(n){o.CHM(e);const s=o.oxw();return o.KtG(s.startMove(n,s.moveTypes.Move))}),o.qZA(),o.YNc(2,we,21,0,"ng-container",8),o.qZA()}if(2&h){const e=o.oxw();o.Udp("top",e.cropper.y1,"px")("left",e.cropper.x1,"px")("width",e.cropper.x2-e.cropper.x1,"px")("height",e.cropper.y2-e.cropper.y1,"px")("margin-left","center"===e.alignImage?e.marginLeft:null)("visibility",e.imageVisible?"visible":"hidden"),o.ekj("ngx-ic-round",e.roundCropper),o.uIk("aria-label",e.cropperFrameAriaLabel),o.xp6(2),o.Q6J("ngIf",!e.hideResizeSquares)}}class B{constructor(){this.format="png",this.output="blob",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperFrameAriaLabel="Crop photo",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(g){Object.keys(g).filter(e=>e in this).forEach(e=>this[e]=g[e]),this.validateOptions()}setOptionsFromChanges(g){Object.keys(g).filter(e=>e in this).forEach(e=>this[e]=g[e].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}var H=function(h){return h.Drag="drag",h.Move="move",h.Resize="resize",h.Pinch="pinch",h}(H||{});function me(h,g){return h/100*g}let Ie=(()=>{class h{crop(e,i,n,s,c){const p=this.getImagePosition(e,i,n,c),m=p.x2-p.x1,v=p.y2-p.y1,f=document.createElement("canvas");f.width=m,f.height=v;const x=f.getContext("2d");if(!x)return null;null!=n.backgroundColor&&(x.fillStyle=n.backgroundColor,x.fillRect(0,0,m,v));const M=(n.transform.scale||1)*(n.transform.flipH?-1:1),T=(n.transform.scale||1)*(n.transform.flipV?-1:1),{translateH:b,translateV:F}=this.getCanvasTranslate(e,n,c),O=e.transformed;x.setTransform(M,0,0,T,O.size.width/2+b,O.size.height/2+F),x.translate(-p.x1/M,-p.y1/T),x.rotate((n.transform.rotate||0)*Math.PI/180),x.drawImage(O.image,-O.size.width/2,-O.size.height/2);const N={width:m,height:v,imagePosition:p,cropperPosition:{...i}};n.containWithinAspectRatio&&(N.offsetImagePosition=this.getOffsetImagePosition(e,i,n,c));const R=this.getResizeRatio(m,v,n);return 1!==R&&(N.width=Math.round(m*R),N.height=n.maintainAspectRatio?Math.round(N.width/n.aspectRatio):Math.round(v*R),function P(h,g,e){const i=h.width,n=h.height,s=i/(g=Math.round(g)),c=n/(e=Math.round(e)),p=Math.ceil(s/2),m=Math.ceil(c/2),v=h.getContext("2d");if(v){const f=v.getImageData(0,0,i,n),x=v.createImageData(g,e),M=f.data,T=x.data;for(let b=0;b<e;b++)for(let F=0;F<g;F++){const O=4*(F+b*g),N=b*c;let R=0,ne=0,le=0,Be=0,Ye=0,be=0,Re=0;const ze=Math.floor(F*s),ht=Math.floor(b*c);let Ue=Math.ceil((F+1)*s),Oe=Math.ceil((b+1)*c);Ue=Math.min(Ue,i),Oe=Math.min(Oe,n);for(let pe=ht;pe<Oe;pe++){const Qe=Math.abs(N-pe)/m,lt=F*s,pt=Qe*Qe;for(let j=ze;j<Ue;j++){const Ve=Math.abs(lt-j)/p,ae=Math.sqrt(pt+Ve*Ve);if(ae>=1)continue;R=2*ae*ae*ae-3*ae*ae+1;const q=4*(j+pe*i);Re+=R*M[q+3],le+=R,M[q+3]<255&&(R=R*M[q+3]/250),Be+=R*M[q],Ye+=R*M[q+1],be+=R*M[q+2],ne+=R}}T[O]=Be/ne,T[O+1]=Ye/ne,T[O+2]=be/ne,T[O+3]=Re/le}h.width=g,h.height=e,v.putImageData(x,0,0)}}(f,N.width,N.height)),"blob"===s?this.cropToBlob(N,f,n):(N.base64=f.toDataURL("image/"+n.format,this.getQuality(n)),N)}cropToBlob(e,i,n){var s=this;return(0,w.Z)(function*(){return e.blob=yield new Promise(c=>i.toBlob(c,"image/"+n.format,s.getQuality(n))),e.blob&&(e.objectUrl=URL.createObjectURL(e.blob)),e})()}getCanvasTranslate(e,i,n){if("px"===i.transform.translateUnit){const s=this.getRatio(e,n);return{translateH:(i.transform.translateH||0)*s,translateV:(i.transform.translateV||0)*s}}return{translateH:i.transform.translateH?me(i.transform.translateH,e.transformed.size.width):0,translateV:i.transform.translateV?me(i.transform.translateV,e.transformed.size.height):0}}getRatio(e,i){return e.transformed.size.width/i.width}getImagePosition(e,i,n,s){const c=this.getRatio(e,s),p={x1:Math.round(i.x1*c),y1:Math.round(i.y1*c),x2:Math.round(i.x2*c),y2:Math.round(i.y2*c)};return n.containWithinAspectRatio||(p.x1=Math.max(p.x1,0),p.y1=Math.max(p.y1,0),p.x2=Math.min(p.x2,e.transformed.size.width),p.y2=Math.min(p.y2,e.transformed.size.height)),p}getOffsetImagePosition(e,i,n,s){const c=n.canvasRotation+e.exifTransform.rotate,p=this.getRatio(e,s);let m,v;c%2?(m=(e.transformed.size.width-e.original.size.height)/2,v=(e.transformed.size.height-e.original.size.width)/2):(m=(e.transformed.size.width-e.original.size.width)/2,v=(e.transformed.size.height-e.original.size.height)/2);const f={x1:Math.round(i.x1*p)-m,y1:Math.round(i.y1*p)-v,x2:Math.round(i.x2*p)-m,y2:Math.round(i.y2*p)-v};return n.containWithinAspectRatio||(f.x1=Math.max(f.x1,0),f.y1=Math.max(f.y1,0),f.x2=Math.min(f.x2,e.transformed.size.width),f.y2=Math.min(f.y2,e.transformed.size.height)),f}getResizeRatio(e,i,n){const s=n.resizeToWidth/e,c=n.resizeToHeight/i,p=new Array;n.resizeToWidth>0&&p.push(s),n.resizeToHeight>0&&p.push(c);const m=0===p.length?1:Math.min(...p);return m>1&&!n.onlyScaleDown?m:Math.min(m,1)}getQuality(e){return Math.min(1,Math.max(0,e.imageQuality/100))}}return h.\u0275fac=function(e){return new(e||h)},h.\u0275prov=o.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})(),Fe=(()=>{class h{resetCropperPosition(e,i,n,s){if(e?.nativeElement)if(n.cropperStaticHeight&&n.cropperStaticWidth)i.x1=0,i.x2=s.width>n.cropperStaticWidth?n.cropperStaticWidth:s.width,i.y1=0,i.y2=s.height>n.cropperStaticHeight?n.cropperStaticHeight:s.height;else{const c=Math.min(n.cropperScaledMaxWidth,s.width),p=Math.min(n.cropperScaledMaxHeight,s.height);if(n.maintainAspectRatio)if(s.width/n.aspectRatio<s.height){i.x1=0,i.x2=c;const m=c/n.aspectRatio;i.y1=(s.height-m)/2,i.y2=i.y1+m}else{i.y1=0,i.y2=p;const m=p*n.aspectRatio;i.x1=(s.width-m)/2,i.x2=i.x1+m}else i.x1=0,i.x2=c,i.y1=0,i.y2=p}}move(e,i,n){const s=this.getClientX(e)-i.clientX,c=this.getClientY(e)-i.clientY;n.x1=i.x1+s,n.y1=i.y1+c,n.x2=i.x2+s,n.y2=i.y2+c}resize(e,i,n,s,c){const p=this.getClientX(e)-i.clientX,m=this.getClientY(e)-i.clientY;switch(i.position){case"left":n.x1=Math.min(Math.max(i.x1+p,n.x2-c.cropperScaledMaxWidth),n.x2-c.cropperScaledMinWidth);break;case"topleft":n.x1=Math.min(Math.max(i.x1+p,n.x2-c.cropperScaledMaxWidth),n.x2-c.cropperScaledMinWidth),n.y1=Math.min(Math.max(i.y1+m,n.y2-c.cropperScaledMaxHeight),n.y2-c.cropperScaledMinHeight);break;case"top":n.y1=Math.min(Math.max(i.y1+m,n.y2-c.cropperScaledMaxHeight),n.y2-c.cropperScaledMinHeight);break;case"topright":n.x2=Math.max(Math.min(i.x2+p,n.x1+c.cropperScaledMaxWidth),n.x1+c.cropperScaledMinWidth),n.y1=Math.min(Math.max(i.y1+m,n.y2-c.cropperScaledMaxHeight),n.y2-c.cropperScaledMinHeight);break;case"right":n.x2=Math.max(Math.min(i.x2+p,n.x1+c.cropperScaledMaxWidth),n.x1+c.cropperScaledMinWidth);break;case"bottomright":n.x2=Math.max(Math.min(i.x2+p,n.x1+c.cropperScaledMaxWidth),n.x1+c.cropperScaledMinWidth),n.y2=Math.max(Math.min(i.y2+m,n.y1+c.cropperScaledMaxHeight),n.y1+c.cropperScaledMinHeight);break;case"bottom":n.y2=Math.max(Math.min(i.y2+m,n.y1+c.cropperScaledMaxHeight),n.y1+c.cropperScaledMinHeight);break;case"bottomleft":n.x1=Math.min(Math.max(i.x1+p,n.x2-c.cropperScaledMaxWidth),n.x2-c.cropperScaledMinWidth),n.y2=Math.max(Math.min(i.y2+m,n.y1+c.cropperScaledMaxHeight),n.y1+c.cropperScaledMinHeight);break;case"center":const v=e.scale,f=Math.min(Math.max(c.cropperScaledMinWidth,Math.abs(i.x2-i.x1)*v),c.cropperScaledMaxWidth),x=Math.min(Math.max(c.cropperScaledMinHeight,Math.abs(i.y2-i.y1)*v),c.cropperScaledMaxHeight);n.x1=i.clientX-f/2,n.x2=i.clientX+f/2,n.y1=i.clientY-x/2,n.y2=i.clientY+x/2,n.x1<0?(n.x2-=n.x1,n.x1=0):n.x2>s.width&&(n.x1-=n.x2-s.width,n.x2=s.width),n.y1<0?(n.y2-=n.y1,n.y1=0):n.y2>s.height&&(n.y1-=n.y2-s.height,n.y2=s.height)}c.maintainAspectRatio&&this.checkAspectRatio(i.position,n,s,c)}checkAspectRatio(e,i,n,s){let c=0,p=0;switch(e){case"top":i.x2=i.x1+(i.y2-i.y1)*s.aspectRatio,c=Math.max(i.x2-n.width,0),p=Math.max(0-i.y1,0),(c>0||p>0)&&(i.x2-=p*s.aspectRatio>c?p*s.aspectRatio:c,i.y1+=p*s.aspectRatio>c?p:c/s.aspectRatio);break;case"bottom":i.x2=i.x1+(i.y2-i.y1)*s.aspectRatio,c=Math.max(i.x2-n.width,0),p=Math.max(i.y2-n.height,0),(c>0||p>0)&&(i.x2-=p*s.aspectRatio>c?p*s.aspectRatio:c,i.y2-=p*s.aspectRatio>c?p:c/s.aspectRatio);break;case"topleft":i.y1=i.y2-(i.x2-i.x1)/s.aspectRatio,c=Math.max(0-i.x1,0),p=Math.max(0-i.y1,0),(c>0||p>0)&&(i.x1+=p*s.aspectRatio>c?p*s.aspectRatio:c,i.y1+=p*s.aspectRatio>c?p:c/s.aspectRatio);break;case"topright":i.y1=i.y2-(i.x2-i.x1)/s.aspectRatio,c=Math.max(i.x2-n.width,0),p=Math.max(0-i.y1,0),(c>0||p>0)&&(i.x2-=p*s.aspectRatio>c?p*s.aspectRatio:c,i.y1+=p*s.aspectRatio>c?p:c/s.aspectRatio);break;case"right":case"bottomright":i.y2=i.y1+(i.x2-i.x1)/s.aspectRatio,c=Math.max(i.x2-n.width,0),p=Math.max(i.y2-n.height,0),(c>0||p>0)&&(i.x2-=p*s.aspectRatio>c?p*s.aspectRatio:c,i.y2-=p*s.aspectRatio>c?p:c/s.aspectRatio);break;case"left":case"bottomleft":i.y2=i.y1+(i.x2-i.x1)/s.aspectRatio,c=Math.max(0-i.x1,0),p=Math.max(i.y2-n.height,0),(c>0||p>0)&&(i.x1+=p*s.aspectRatio>c?p*s.aspectRatio:c,i.y2-=p*s.aspectRatio>c?p:c/s.aspectRatio);break;case"center":i.x2=i.x1+(i.y2-i.y1)*s.aspectRatio,i.y2=i.y1+(i.x2-i.x1)/s.aspectRatio;const m=Math.max(0-i.x1,0),v=Math.max(i.x2-n.width,0),f=Math.max(i.y2-n.height,0),x=Math.max(0-i.y1,0);(m>0||v>0||f>0||x>0)&&(i.x1+=f*s.aspectRatio>m?f*s.aspectRatio:m,i.x2-=x*s.aspectRatio>v?x*s.aspectRatio:v,i.y1+=x*s.aspectRatio>v?x:v/s.aspectRatio,i.y2-=f*s.aspectRatio>m?f:m/s.aspectRatio)}}getClientX(e){return e.touches?.[0].clientX||e.clientX||0}getClientY(e){return e.touches?.[0].clientY||e.clientY||0}}return h.\u0275fac=function(e){return new(e||h)},h.\u0275prov=o.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();let ve=(()=>{class h{constructor(){this.autoRotateSupported=function fe(){return new Promise(h=>{const g=new Image;g.onload=()=>{h(1===g.width&&2===g.height)},g.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(e,i){return e.arrayBuffer().then(n=>this.checkImageTypeAndLoadImageFromArrayBuffer(n,e.type,i))}checkImageTypeAndLoadImageFromArrayBuffer(e,i,n){return this.isValidImageType(i)?this.loadImageFromArrayBuffer(e,n):Promise.reject(new Error("Invalid image type"))}isValidImageType(e){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(e)}loadImageFromURL(e,i){return fetch(e).then(n=>n.arrayBuffer()).then(n=>this.loadImageFromArrayBuffer(n,i))}loadBase64Image(e,i){const n=this.base64ToArrayBuffer(e);return this.loadImageFromArrayBuffer(n,i)}base64ToArrayBuffer(e){e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");const i=atob(e),n=i.length,s=new Uint8Array(n);for(let c=0;c<n;c++)s[c]=i.charCodeAt(c);return s.buffer}loadImageFromArrayBuffer(e,i){return new Promise((n,s)=>{const c=new Blob([e]),p=URL.createObjectURL(c),m=new Image;m.onload=()=>n({originalImage:m,originalObjectUrl:p,originalArrayBuffer:e}),m.onerror=s,m.src=p}).then(n=>this.transformImageFromArrayBuffer(n,i))}transformImageFromArrayBuffer(e,i){var n=this;return(0,w.Z)(function*(){const s=yield n.autoRotateSupported,c=yield function We(h){switch("object"==typeof h&&(h=function Z(h){const g=new DataView(h);if(65496!==g.getUint16(0,!1))return-2;const e=g.byteLength;let i=2;for(;i<e;){if(g.getUint16(i+2,!1)<=8)return-1;const n=g.getUint16(i,!1);if(i+=2,65505==n){if(1165519206!==g.getUint32(i+=2,!1))return-1;const s=18761==g.getUint16(i+=6,!1);i+=g.getUint32(i+4,s);const c=g.getUint16(i,s);i+=2;for(let p=0;p<c;p++)if(274==g.getUint16(i+12*p,s))return g.getUint16(i+12*p+8,s)}else{if(65280!=(65280&n))break;i+=g.getUint16(i,!1)}}return-1}(h)),h){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(s?-1:e.originalArrayBuffer);return e.originalImage&&e.originalImage.complete?n.transformLoadedImage({original:{objectUrl:e.originalObjectUrl,image:e.originalImage,size:{width:e.originalImage.naturalWidth,height:e.originalImage.naturalHeight}},exifTransform:c},i):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(e,i){var n=this;return(0,w.Z)(function*(){const s=i.canvasRotation+e.exifTransform.rotate,c={width:e.original.image.naturalWidth,height:e.original.image.naturalHeight};if(0===s&&!e.exifTransform.flip&&!i.containWithinAspectRatio)return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:{...c}},transformed:{objectUrl:e.original.objectUrl,image:e.original.image,size:{...c}},exifTransform:e.exifTransform};const p=n.getTransformedSize(c,e.exifTransform,i),m=document.createElement("canvas");m.width=p.width,m.height=p.height;const v=m.getContext("2d");v?.setTransform(e.exifTransform.flip?-1:1,0,0,1,m.width/2,m.height/2),v?.rotate(Math.PI*(s/2)),v?.drawImage(e.original.image,-c.width/2,-c.height/2);const f=yield new Promise(T=>m.toBlob(T,i.format));if(!f)throw new Error("Failed to get Blob for transformed image.");const x=URL.createObjectURL(f),M=yield n.loadImageFromObjectUrl(x);return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:{...c}},transformed:{objectUrl:x,image:M,size:{width:M.width,height:M.height}},exifTransform:e.exifTransform}})()}loadImageFromObjectUrl(e){return new Promise((i,n)=>{const s=new Image;s.onload=()=>i(s),s.onerror=n,s.src=e})}getTransformedSize(e,i,n){const s=n.canvasRotation+i.rotate;if(n.containWithinAspectRatio){if(s%2){const p=e.height/n.aspectRatio;return{width:Math.max(e.height,e.width*n.aspectRatio),height:Math.max(e.width,p)}}{const p=e.width/n.aspectRatio;return{width:Math.max(e.width,e.height*n.aspectRatio),height:Math.max(e.height,p)}}}return s%2?{height:e.width,width:e.height}:{width:e.width,height:e.height}}}return h.\u0275fac=function(e){return new(e||h)},h.\u0275prov=o.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})(),ie=(()=>{class h{constructor(e,i,n,s,c,p,m){this.cropService=e,this.cropperPositionService=i,this.loadImageService=n,this.sanitizer=s,this.cd=c,this.zone=p,this.hammerLoader=m,this.settings=new B,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=H,this.imageVisible=!1,this.cropperFrameAriaLabel=this.settings.cropperFrameAriaLabel,this.output=this.settings.output,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new o.vpe,this.startCropImage=new o.vpe,this.imageLoaded=new o.vpe,this.cropperReady=new o.vpe,this.loadImageFailed=new o.vpe,this.transformChange=new o.vpe,this.reset()}ngOnChanges(e){this.onChangesUpdateSettings(e),this.onChangesInputImage(e),this.loadedImage?.original.image.complete&&(e.containWithinAspectRatio||e.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i)),(e.cropper||e.maintainAspectRatio||e.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),!this.maintainAspectRatio||!this.resetCropOnAspectRatioChange&&this.aspectRatioIsCorrect()||!e.maintainAspectRatio&&!e.aspectRatio?e.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()):this.resetCropperPosition()),e.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop()),e.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(e){this.settings.setOptionsFromChanges(e),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&(this.hideResizeSquares=!0,this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1}))}onChangesInputImage(e){(e.imageChangedEvent||e.imageURL||e.imageBase64||e.imageFile)&&this.reset(),e.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),e.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),e.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),e.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){return this.imageChangedEvent?.target?.files?.length>0}setCssTransform(){const e=this.transform?.translateUnit||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${e}, ${this.transform.translateV||0}${e}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(e){this.loadImageService.loadImageFile(e,this.settings).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadBase64Image(e){this.loadImageService.loadBase64Image(e,this.settings).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadImageFromURL(e){this.loadImageService.loadImageFromURL(e,this.settings).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}setLoadedImage(e){this.loadedImage=e,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e.transformed.objectUrl),this.cd.markForCheck()}loadImageError(e){console.error(e),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit({...this.maxSize}),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>0}onResize(){if(this.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{const e={...this.maxSize};this.setMaxSize(),this.resizeCropperPosition(e),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}}activatePinchGesture(){var e=this;return(0,w.Z)(function*(){yield e.hammerLoader?.();const i=window?.Hammer||null;if(i){const n=new i(e.wrapper.nativeElement);n.get("pinch").set({enable:!0}),n.on("pinchmove",e.onPinch.bind(e)),n.on("pinchend",e.pinchStop.bind(e)),n.on("pinchstart",e.startPinch.bind(e))}else(0,o.X6Q)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")})()}resizeCropperPosition(e){(e.width!==this.maxSize.width||e.height!==this.maxSize.height)&&(this.cropper.x1=this.cropper.x1*this.maxSize.width/e.width,this.cropper.x2=this.cropper.x2*this.maxSize.width/e.width,this.cropper.y1=this.cropper.y1*this.maxSize.height/e.height,this.cropper.y2=this.cropper.y2*this.maxSize.height/e.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings,this.maxSize),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(e){this.changeKeyboardStepSize(e),this.keyboardMoveCropper(e)}changeKeyboardStepSize(e){const i=+e.key;i>=1&&i<=9&&(this.settings.stepSize=i)}keyboardMoveCropper(e){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(e.key))return;const n=e.shiftKey?H.Resize:H.Move,s=e.altKey?function De(h){switch(h){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}(e.key):function W(h){switch(h){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}(e.key),c=function tt(h,g){switch(h){case"ArrowUp":return{clientX:0,clientY:-1*g};case"ArrowRight":return{clientX:g,clientY:0};case"ArrowDown":return{clientX:0,clientY:g};default:return{clientX:-1*g,clientY:0}}}(e.key,this.settings.stepSize);e.preventDefault(),e.stopPropagation(),this.startMove({clientX:0,clientY:0},n,s),this.handleMouseMove(c),this.handleMouseUp()}startMove(e,i,n=null){this.disabled||this.moveStart?.active&&this.moveStart?.type===H.Pinch||i===H.Drag&&!this.allowMoveImage||(e.preventDefault&&e.preventDefault(),this.moveStart={active:!0,type:i,position:n,transform:{...this.transform},clientX:this.cropperPositionService.getClientX(e),clientY:this.cropperPositionService.getClientY(e),...this.cropper},this.initMouseMove())}initMouseMove(){(0,E.T)((0,se.R)(document,"mousemove"),(0,se.R)(document,"touchmove")).pipe((0,$e.R)((0,E.T)((0,se.R)(document,"mouseup"),(0,se.R)(document,"touchend")).pipe((0,et.P)()))).subscribe({next:e=>this.zone.run(()=>{this.handleMouseMove(e),this.cd.markForCheck()}),complete:()=>this.zone.run(()=>{this.handleMouseUp(),this.cd.markForCheck()})})}startPinch(e){this.safeImgDataUrl&&(e.preventDefault&&e.preventDefault(),this.moveStart={active:!0,type:H.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2,...this.cropper})}handleMouseMove(e){if(this.moveStart.active)if(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.moveStart.type===H.Move)this.cropperPositionService.move(e,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===H.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(e,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===H.Drag){const i=this.cropperPositionService.getClientX(e)-this.moveStart.clientX,n=this.cropperPositionService.getClientY(e)-this.moveStart.clientY;this.transform={...this.transform,translateH:(this.moveStart.transform?.translateH||0)+i,translateV:(this.moveStart.transform?.translateV||0)+n},this.setCssTransform()}}onPinch(e){this.moveStart.active&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.moveStart.type===H.Pinch&&(this.cropperPositionService.resize(e,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.markForCheck())}setMaxSize(){if(this.sourceImage){const e=getComputedStyle(this.sourceImage.nativeElement);this.maxSize.width=parseFloat(e.width),this.maxSize.height=parseFloat(e.height),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.loadedImage?.transformed?.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.settings.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed?.image){const e=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/e:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/e:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(e=!1){this.cropper.x1<0&&(this.cropper.x2-=e?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=e?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=e?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=e?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}handleMouseUp(){this.moveStart.active&&(this.moveStart.active=!1,this.moveStart?.type===H.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(e=this.settings.output){if(null!=this.loadedImage?.transformed?.image){if(this.startCropImage.emit(),"blob"===e)return this.cropToBlob();if("base64"===e)return this.cropToBase64()}return null}cropToBlob(){var e=this;return new Promise((i,n)=>this.zone.run((0,w.Z)(function*(){const s=yield e.cropService.crop(e.loadedImage,e.cropper,e.settings,"blob",e.maxSize);s?(e.imageCropped.emit(s),i(s)):n("Crop image failed")})))}cropToBase64(){const e=this.cropService.crop(this.loadedImage,this.cropper,this.settings,"base64",this.maxSize);return e?(this.imageCropped.emit(e),e):null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}}return h.\u0275fac=function(e){return new(e||h)(o.Y36(Ie),o.Y36(Fe),o.Y36(ve),o.Y36(Je.H7),o.Y36(o.sBO),o.Y36(o.R0b),o.Y36(Je.vm,8))},h.\u0275cmp=o.Xpm({type:h,selectors:[["image-cropper"]],viewQuery:function(e,i){if(1&e&&(o.Gf(ee,7),o.Gf(X,5)),2&e){let n;o.iGM(n=o.CRH())&&(i.wrapper=n.first),o.iGM(n=o.CRH())&&(i.sourceImage=n.first)}},hostVars:6,hostBindings:function(e,i){1&e&&o.NdJ("resize",function(){return i.onResize()},!1,o.Jf7),2&e&&(o.Udp("text-align",i.alignImage),o.ekj("disabled",i.disabled)("ngx-ix-hidden",i.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},features:[o.TTD],decls:5,vars:10,consts:[["wrapper",""],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"src","load","mousedown","touchstart","error"],["sourceImage",""],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(e,i){1&e&&(o.TgZ(0,"div",null,0),o.YNc(2,Te,2,8,"img",1),o._UZ(3,"div",2),o.YNc(4,te,3,16,"div",3),o.qZA()),2&e&&(o.Udp("background",i.imageVisible&&i.backgroundColor),o.xp6(2),o.Q6J("ngIf",i.safeImgDataUrl),o.xp6(1),o.Udp("width",i.maxSize.width,"px")("height",i.maxSize.height,"px")("margin-left","center"===i.alignImage?i.marginLeft:null),o.xp6(1),o.Q6J("ngIf",i.imageVisible))},dependencies:[$.O5],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535C;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0}),h})(),xe=(()=>{class h{}return h.\u0275fac=function(e){return new(e||h)},h.\u0275mod=o.oAB({type:h}),h.\u0275inj=o.cJS({imports:[[$.ez]]}),h})();A(7271);var rt=A(9397),nt=A(8180),Le=A(6306),at=A(8954),Se=A(7110),ot=A(1347),st=A(9281),ce=A(9045),ct=A(9503),y=function(h){return h[h.Up=1]="Up",h[h.Down=3]="Down",h[h.Right=6]="Right",h[h.Left=8]="Left",h[h.UpMirrored=2]="UpMirrored",h[h.DownMirrored=4]="DownMirrored",h[h.LeftMirrored=5]="LeftMirrored",h[h.RightMirrored=7]="RightMirrored",h[h.Default=0]="Default",h[h.NotJpeg=-1]="NotJpeg",h[h.NotDefined=-2]="NotDefined",h}(y||{});class _{}_.getOrientation=h=>new Promise((g,e)=>{try{const i=new FileReader;i.onload=()=>{const n=new DataView(i.result);if(!n.byteLength||65496!==n.getUint16(0,!1))return g(y.NotDefined);const s=n.byteLength;let c=2;for(;c<s;){const p=n.getUint16(c,!1);if(c+=2,65505===p){if(1165519206!==n.getUint32(c+=2,!1))return g(y.NotJpeg);const m=18761===n.getUint16(c+=6,!1);c+=n.getUint32(c+4,m);const v=n.getUint16(c,m);c+=2;for(let f=0;f<v;f++)if(274===n.getUint16(c+12*f,m))return g(n.getUint16(c+12*f+8,m))}else{if(65280!=(65280&p))break;c+=n.getUint16(c,!1)}}return g(y.NotJpeg)},i.readAsArrayBuffer(h)}catch{return e(y.Default)}}),_.uploadFile=(h,g=!0,e=!1)=>new Promise(function(i,n){const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),c=/iPad|iPhone|iPod/i.test(navigator.userAgent);Promise.resolve(s||c).then(p=>p?_.generateUploadInputNative(window.document,g,e):_.generateUploadInputRenderer(h,g,e)).then(p=>{const m=p?Array.from(p):[],v=m.map(M=>_.getOrientation(M)),f=m.map(M=>_.fileToDataURL(M));let x=[];Promise.all(v).then(M=>(x=M,Promise.all(f))).then(M=>{const T=M.map((b,F)=>({image:b.dataUrl,orientation:x[F],fileName:b.fileName}));i(g?T:T[0])})}).catch(p=>n(p))}),_.fileToDataURL=h=>new Promise((g,e)=>{const i=new FileReader;i.onload=n=>{g({dataUrl:n.target.result,fileName:h.name})};try{i.readAsDataURL(h)}catch(n){e(`ngx-image-compress - probably no file have been selected: ${n}`)}}),_.generateUploadInputRenderer=(h,g=!0,e=!1)=>{let i=!1;return new Promise((n,s)=>{const c=h.createElement("input");h.setStyle(c,"display","none"),h.setProperty(c,"type","file"),h.setProperty(c,"accept","image/*"),g&&h.setProperty(c,"multiple","true"),h.listen(c,"click",p=>{p.target.value=""}),h.listen(c,"change",p=>{i=!0,n(p.target.files)}),e&&window.addEventListener("focus",()=>{setTimeout(()=>{i||s(new Error("file upload on blur - no file selected"))},300)},{once:!0}),c.click()})},_.generateUploadInputNative=(h,g=!0,e=!1)=>{let i=!1;return new Promise((n,s)=>{const c=h.createElement("input");c.id="upload-input"+new Date,c.style.display="none",c.setAttribute("type","file"),c.setAttribute("accept","image/*"),g&&c.setAttribute("multiple","true"),h.body.appendChild(c),c.addEventListener("change",()=>{i=!0,n(c.files),h.body.removeChild(h.getElementById(c.id))},{once:!0}),e&&window.addEventListener("focus",()=>{setTimeout(()=>{!i&&h.getElementById(c.id)&&(s(new Error("file upload on blur - no file selected")),h.body.removeChild(h.getElementById(c.id)))},300)},{once:!0}),c.click()})},_.compress=(h,g,e,i=50,n=50,s=0,c=0)=>new Promise(function(p,m){n/=100,i/=100;const v=new Image;v.onload=()=>{const f=e.createElement("canvas"),x=f.getContext("2d");if(!x)return m("No canvas context available");let M=v.naturalWidth,T=v.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(g===y.Right||g===y.Left)){const ne=M;M=T,T=ne}i=Math.min(i,s?s/M:1,c?c/T:1),f.width=M*i,f.height=T*i;const O=Math.PI/180;CSS.supports("image-orientation","from-image")||g===y.Up?x.drawImage(v,0,0,f.width,f.height):g===y.Right?(x.save(),x.rotate(90*O),x.translate(0,-f.width),x.drawImage(v,0,0,f.height,f.width),x.restore()):g===y.Left?(x.save(),x.rotate(-90*O),x.translate(-f.width,0),x.drawImage(v,0,0,f.height,f.width),x.restore()):g===y.Down?(x.save(),x.rotate(180*O),x.translate(-f.width,-f.height),x.drawImage(v,0,0,f.width,f.height),x.restore()):x.drawImage(v,0,0,f.width,f.height);const N=h.substr(5,h.split(";")[0].length-5),R=f.toDataURL(N,n);p(R)},v.onerror=f=>m(f),v.src=h}),_.byteCount=h=>encodeURI(h).split(/%..|./).length-1,_.getImageMaxSize=function(){var h=(0,w.Z)(function*(g,e,i,n=!1){const c=v=>(v/1024/1024).toFixed(2);e&&console.debug("NgxImageCompress - Opening upload window");const p=yield _.uploadFile(i,!1,n);let m;for(let v=0;v<10;v++){const f=_.byteCount(p.image);m=yield _.compress(p.image,p.orientation,i,50,100);const x=_.byteCount(m);if(console.debug("NgxImageCompress -","Compression from",c(f),"MB to",c(x),"MB"),x>=f)throw 0===v?(e&&console.debug("NgxImageCompress -","File can't be reduced at all - returning the original",c(f),"MB large"),{...p,image:m}):(e&&console.debug("NgxImageCompress -","File can't be reduced more - returning the best we can, which is ",c(f),"MB large"),{...p,image:m});if(x<1024*g*1024)return e&&console.debug("NgxImageCompress -","Here your file",c(x),"MB large"),{...p,image:m};if(9===v)throw e&&console.debug("NgxImageCompress -","File can't reach the desired size after",10,"tries. Returning file ",c(f),"MB large"),{...p,image:m};e&&console.debug("NgxImageCompress -","Reached",c(x),"MB large. Trying another time after",v+1,"times"),p.image=m}throw e&&console.debug("NgxImageCompress - Unexpected error"),{}});return function(g,e,i){return h.apply(this,arguments)}}();let he=(()=>{class h{constructor(e){this.DOC_ORIENTATION=y,this.render=e.createRenderer(null,null)}byteCount(e){return _.byteCount(e)}getOrientation(e){return _.getOrientation(e)}uploadFile(){return _.uploadFile(this.render,!1)}uploadMultipleFiles(){return _.uploadFile(this.render,!0)}uploadFileOrReject(){return _.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return _.uploadFile(this.render,!0,!0)}compressFile(e,i,n=50,s=50,c=0,p=0){return _.compress(e,i,this.render,n,s,c,p)}uploadAndGetImageWithMaxSize(e=1,i=!1,n=!1){return _.getImageMaxSize(e,i,this.render,n).then(s=>s.image).catch(s=>{throw s.image})}uploadAndGetImageWithMaxSizeAndMetas(e=1,i=!1,n=!1){return _.getImageMaxSize(e,i,this.render,n)}}return h.\u0275fac=function(e){return new(e||h)(o.LFG(o.FYo))},h.\u0275prov=o.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})();const L=["fileInput"];let G=(()=>{class h{constructor(e,i,n,s,c,p){this.avatarService=e,this.router=i,this.location=n,this.apiService=s,this.mainApiService=c,this.imageCompress=p,this.transform={},this.appRoutes=Se.zV,this.imageChangedEvent=this.avatarService.imageChangedEvent}imageCropped(e){this.avatarService.setCroppedImage(e)}onSavePhoto(){this.setUserAvatarDraft(),this.avatarService.setFileEventDraft(this.avatarService.imageChangedEvent())}onChangePhoto(){this.fileInput.nativeElement.click()}fileChangeEvent(e){e.target.value&&this.avatarService.setImageChangeEvent(e)}setUserAvatarDraft(){this.imageCompress.compressFile(this.avatarService.croppedImage().objectUrl,0,50,75).then(e=>{this.avatarService.setUserAvatarDraft(e),this.updateUserAvatarAndLeave()})}updateUserAvatarAndLeave(){this.apiService.currentUser()?this.mainApiService.updateUser({avatar:this.avatarService.userAvatarDraft()}).pipe((0,rt.b)(()=>this.location.back()),(0,nt.q)(1),(0,Le.K)(()=>this.router.navigateByUrl(`/${Se.zV.NotFound}`))).subscribe():this.location.back()}static#e=this.\u0275fac=function(i){return new(i||h)(o.Y36(ot.o),o.Y36(st.F0),o.Y36($.Ye),o.Y36(ce.s),o.Y36(ct.T),o.Y36(he))};static#t=this.\u0275cmp=o.Xpm({type:h,selectors:[["epm-avatar-edit"]],viewQuery:function(i,n){if(1&i&&o.Gf(L,5),2&i){let s;o.iGM(s=o.CRH())&&(n.fileInput=s.first)}},standalone:!0,features:[o.jDz],decls:7,vars:10,consts:[["format","png",3,"imageChangedEvent","maintainAspectRatio","aspectRatio","roundCropper","cropperMaxWidth","cropperMaxHeight","hideResizeSquares","transform","allowMoveImage","transformChange","imageCropped"],[1,"primary",3,"isDisabled","click"],["type","file","accept",".png, .jpg, .jpeg",3,"change"],["fileInput",""],[1,"secondary",3,"click"]],template:function(i,n){1&i&&(o.TgZ(0,"image-cropper",0),o.NdJ("transformChange",function(c){return n.transform=c})("imageCropped",function(c){return n.imageCropped(c)}),o.qZA(),o.TgZ(1,"epm-button",1),o.NdJ("click",function(){return n.onSavePhoto()}),o._uU(2,"Save"),o.qZA(),o.TgZ(3,"input",2,3),o.NdJ("change",function(c){return n.fileChangeEvent(c)}),o.qZA(),o.TgZ(5,"epm-button",4),o.NdJ("click",function(){return n.onChangePhoto()}),o._uU(6,"Change photo"),o.qZA()),2&i&&(o.Q6J("imageChangedEvent",n.imageChangedEvent())("maintainAspectRatio",!0)("aspectRatio",1)("roundCropper",!0)("cropperMaxWidth",600)("cropperMaxHeight",600)("hideResizeSquares",!1)("transform",n.transform)("allowMoveImage",!0),o.xp6(1),o.Q6J("isDisabled",!n.imageChangedEvent().target))},dependencies:[$.ez,at.c,xe,ie],styles:["[_nghost-%COMP%]{padding:0 16px;display:block;background-color:#fff;min-height:calc(100vh - 56px)}[_nghost-%COMP%]     .button{margin-bottom:12px}image-cropper[_ngcontent-%COMP%]{--cropper-outline-color: rgba(77, 82, 103, .6);margin-bottom:20px}input[type=file][_ngcontent-%COMP%]{display:none}"]})}return h})()},7271:(Ke,Ae,A)=>{var $;!function(w,o,Je,E){"use strict";var W,se=["","webkit","Moz","MS","ms","o"],$e=o.createElement("div"),et="function",ee=Math.round,X=Math.abs,Te=Date.now;function we(t,r,a){return setTimeout(me(t,a),r)}function te(t,r,a){return!!Array.isArray(t)&&(B(t,a[r],a),!0)}function B(t,r,a){var l;if(t)if(t.forEach)t.forEach(r,a);else if(t.length!==E)for(l=0;l<t.length;)r.call(a,t[l],l,t),l++;else for(l in t)t.hasOwnProperty(l)&&r.call(a,t[l],l,t)}function H(t,r,a){var l="DEPRECATED METHOD: "+r+"\n"+a+" AT \n";return function(){var u=new Error("get-stack-trace"),d=u&&u.stack?u.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",C=w.console&&(w.console.warn||w.console.log);return C&&C.call(w.console,l,d),t.apply(this,arguments)}}W="function"!=typeof Object.assign?function(r){if(r===E||null===r)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(r),l=1;l<arguments.length;l++){var u=arguments[l];if(u!==E&&null!==u)for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])}return a}:Object.assign;var De=H(function(r,a,l){for(var u=Object.keys(a),d=0;d<u.length;)(!l||l&&r[u[d]]===E)&&(r[u[d]]=a[u[d]]),d++;return r},"extend","Use `assign`."),tt=H(function(r,a){return De(r,a,!0)},"merge","Use `assign`.");function P(t,r,a){var u,l=r.prototype;(u=t.prototype=Object.create(l)).constructor=t,u._super=l,a&&W(u,a)}function me(t,r){return function(){return t.apply(r,arguments)}}function Ie(t,r){return typeof t==et?t.apply(r&&r[0]||E,r):t}function Fe(t,r){return t===E?r:t}function de(t,r,a){B(ve(r),function(l){t.addEventListener(l,a,!1)})}function fe(t,r,a){B(ve(r),function(l){t.removeEventListener(l,a,!1)})}function We(t,r){for(;t;){if(t==r)return!0;t=t.parentNode}return!1}function Z(t,r){return t.indexOf(r)>-1}function ve(t){return t.trim().split(/\s+/g)}function ie(t,r,a){if(t.indexOf&&!a)return t.indexOf(r);for(var l=0;l<t.length;){if(a&&t[l][a]==r||!a&&t[l]===r)return l;l++}return-1}function xe(t){return Array.prototype.slice.call(t,0)}function it(t,r,a){for(var l=[],u=[],d=0;d<t.length;){var C=r?t[d][r]:t[d];ie(u,C)<0&&l.push(t[d]),u[d]=C,d++}return a&&(l=r?l.sort(function(z,D){return z[r]>D[r]}):l.sort()),l}function Ee(t,r){for(var a,l,u=r[0].toUpperCase()+r.slice(1),d=0;d<se.length;){if((l=(a=se[d])?a+u:r)in t)return l;d++}return E}var rt=1;function Le(t){var r=t.ownerDocument||t;return r.defaultView||r.parentWindow||w}var Se="ontouchstart"in w,ot=Ee(w,"PointerEvent")!==E,st=Se&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),ce="touch",ke="mouse",Mt=25,U=1,I=4,y=8,Ce=1,_=2,he=4,_e=8,Me=16,L=_|he,G=_e|Me,h=L|G,g=["x","y"],e=["clientX","clientY"];function i(t,r){var a=this;this.manager=t,this.callback=r,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(l){Ie(t.options.enable,[t])&&a.handler(l)},this.init()}function s(t,r,a){var l=a.pointers.length,u=a.changedPointers.length,d=r&U&&l-u==0,C=r&(I|y)&&l-u==0;a.isFirst=!!d,a.isFinal=!!C,d&&(t.session={}),a.eventType=r,function c(t,r){var a=t.session,l=r.pointers,u=l.length;a.firstInput||(a.firstInput=v(r)),u>1&&!a.firstMultiple?a.firstMultiple=v(r):1===u&&(a.firstMultiple=!1);var d=a.firstInput,C=a.firstMultiple,S=C?C.center:d.center,z=r.center=f(l);r.timeStamp=Te(),r.deltaTime=r.timeStamp-d.timeStamp,r.angle=b(S,z),r.distance=T(S,z),function p(t,r){var a=r.center,l=t.offsetDelta||{},u=t.prevDelta||{},d=t.prevInput||{};(r.eventType===U||d.eventType===I)&&(u=t.prevDelta={x:d.deltaX||0,y:d.deltaY||0},l=t.offsetDelta={x:a.x,y:a.y}),r.deltaX=u.x+(a.x-l.x),r.deltaY=u.y+(a.y-l.y)}(a,r),r.offsetDirection=M(r.deltaX,r.deltaY);var D=x(r.deltaTime,r.deltaX,r.deltaY);r.overallVelocityX=D.x,r.overallVelocityY=D.y,r.overallVelocity=X(D.x)>X(D.y)?D.x:D.y,r.scale=C?function O(t,r){return T(r[0],r[1],e)/T(t[0],t[1],e)}(C.pointers,l):1,r.rotation=C?function F(t,r){return b(r[1],r[0],e)+b(t[1],t[0],e)}(C.pointers,l):0,r.maxPointers=a.prevInput?r.pointers.length>a.prevInput.maxPointers?r.pointers.length:a.prevInput.maxPointers:r.pointers.length,function m(t,r){var u,d,C,S,a=t.lastInterval||r,l=r.timeStamp-a.timeStamp;if(r.eventType!=y&&(l>Mt||a.velocity===E)){var z=r.deltaX-a.deltaX,D=r.deltaY-a.deltaY,V=x(l,z,D);d=V.x,C=V.y,u=X(V.x)>X(V.y)?V.x:V.y,S=M(z,D),t.lastInterval=r}else u=a.velocity,d=a.velocityX,C=a.velocityY,S=a.direction;r.velocity=u,r.velocityX=d,r.velocityY=C,r.direction=S}(a,r);var V=t.element;We(r.srcEvent.target,V)&&(V=r.srcEvent.target),r.target=V}(t,a),t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}function v(t){for(var r=[],a=0;a<t.pointers.length;)r[a]={clientX:ee(t.pointers[a].clientX),clientY:ee(t.pointers[a].clientY)},a++;return{timeStamp:Te(),pointers:r,center:f(r),deltaX:t.deltaX,deltaY:t.deltaY}}function f(t){var r=t.length;if(1===r)return{x:ee(t[0].clientX),y:ee(t[0].clientY)};for(var a=0,l=0,u=0;u<r;)a+=t[u].clientX,l+=t[u].clientY,u++;return{x:ee(a/r),y:ee(l/r)}}function x(t,r,a){return{x:r/t||0,y:a/t||0}}function M(t,r){return t===r?Ce:X(t)>=X(r)?t<0?_:he:r<0?_e:Me}function T(t,r,a){a||(a=g);var l=r[a[0]]-t[a[0]],u=r[a[1]]-t[a[1]];return Math.sqrt(l*l+u*u)}function b(t,r,a){return a||(a=g),180*Math.atan2(r[a[1]]-t[a[1]],r[a[0]]-t[a[0]])/Math.PI}i.prototype={handler:function(){},init:function(){this.evEl&&de(this.element,this.evEl,this.domHandler),this.evTarget&&de(this.target,this.evTarget,this.domHandler),this.evWin&&de(Le(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&fe(this.element,this.evEl,this.domHandler),this.evTarget&&fe(this.target,this.evTarget,this.domHandler),this.evWin&&fe(Le(this.element),this.evWin,this.domHandler)}};var N={mousedown:U,mousemove:2,mouseup:I},R="mousedown",ne="mousemove mouseup";function le(){this.evEl=R,this.evWin=ne,this.pressed=!1,i.apply(this,arguments)}P(le,i,{handler:function(r){var a=N[r.type];a&U&&0===r.button&&(this.pressed=!0),2&a&&1!==r.which&&(a=I),this.pressed&&(a&I&&(this.pressed=!1),this.callback(this.manager,a,{pointers:[r],changedPointers:[r],pointerType:ke,srcEvent:r}))}});var Be={pointerdown:U,pointermove:2,pointerup:I,pointercancel:y,pointerout:y},Ye={2:ce,3:"pen",4:ke,5:"kinect"},be="pointerdown",Re="pointermove pointerup pointercancel";function ze(){this.evEl=be,this.evWin=Re,i.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}w.MSPointerEvent&&!w.PointerEvent&&(be="MSPointerDown",Re="MSPointerMove MSPointerUp MSPointerCancel"),P(ze,i,{handler:function(r){var a=this.store,l=!1,u=r.type.toLowerCase().replace("ms",""),d=Be[u],C=Ye[r.pointerType]||r.pointerType,S=C==ce,z=ie(a,r.pointerId,"pointerId");d&U&&(0===r.button||S)?z<0&&(a.push(r),z=a.length-1):d&(I|y)&&(l=!0),!(z<0)&&(a[z]=r,this.callback(this.manager,d,{pointers:a,changedPointers:[r],pointerType:C,srcEvent:r}),l&&a.splice(z,1))}});var ht={touchstart:U,touchmove:2,touchend:I,touchcancel:y};function pe(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,i.apply(this,arguments)}function Qe(t,r){var a=xe(t.touches),l=xe(t.changedTouches);return r&(I|y)&&(a=it(a.concat(l),"identifier",!0)),[a,l]}P(pe,i,{handler:function(r){var a=ht[r.type];if(a===U&&(this.started=!0),this.started){var l=Qe.call(this,r,a);a&(I|y)&&l[0].length-l[1].length==0&&(this.started=!1),this.callback(this.manager,a,{pointers:l[0],changedPointers:l[1],pointerType:ce,srcEvent:r})}}});var lt={touchstart:U,touchmove:2,touchend:I,touchcancel:y},pt="touchstart touchmove touchend touchcancel";function j(){this.evTarget=pt,this.targetIds={},i.apply(this,arguments)}function Ve(t,r){var a=xe(t.touches),l=this.targetIds;if(r&(2|U)&&1===a.length)return l[a[0].identifier]=!0,[a,a];var u,d,C=xe(t.changedTouches),S=[],z=this.target;if(d=a.filter(function(D){return We(D.target,z)}),r===U)for(u=0;u<d.length;)l[d[u].identifier]=!0,u++;for(u=0;u<C.length;)l[C[u].identifier]&&S.push(C[u]),r&(I|y)&&delete l[C[u].identifier],u++;return S.length?[it(d.concat(S),"identifier",!0),S]:void 0}P(j,i,{handler:function(r){var a=lt[r.type],l=Ve.call(this,r,a);l&&this.callback(this.manager,a,{pointers:l[0],changedPointers:l[1],pointerType:ce,srcEvent:r})}});var ae=2500;function ut(){i.apply(this,arguments);var t=me(this.handler,this);this.touch=new j(this.manager,t),this.mouse=new le(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function zt(t,r){t&U?(this.primaryTouch=r.changedPointers[0].identifier,yt.call(this,r)):t&(I|y)&&yt.call(this,r)}function yt(t){var r=t.changedPointers[0];if(r.identifier===this.primaryTouch){var a={x:r.clientX,y:r.clientY};this.lastTouches.push(a);var l=this.lastTouches;setTimeout(function(){var d=l.indexOf(a);d>-1&&l.splice(d,1)},ae)}}function Ut(t){for(var r=t.srcEvent.clientX,a=t.srcEvent.clientY,l=0;l<this.lastTouches.length;l++){var u=this.lastTouches[l],d=Math.abs(r-u.x),C=Math.abs(a-u.y);if(d<=25&&C<=25)return!0}return!1}P(ut,i,{handler:function(r,a,l){var d=l.pointerType==ke;if(!(d&&l.sourceCapabilities&&l.sourceCapabilities.firesTouchEvents)){if(l.pointerType==ce)zt.call(this,a,l);else if(d&&Ut.call(this,l))return;this.callback(r,a,l)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var At=Ee($e.style,"touchAction"),Tt=At!==E,wt="compute",gt="manipulation",ue="none",He="pan-x",Pe="pan-y",Xe=function Ht(){if(!Tt)return!1;var t={},r=w.CSS&&w.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(a){t[a]=!r||w.CSS.supports("touch-action",a)}),t}();function mt(t,r){this.manager=t,this.set(r)}mt.prototype={set:function(t){t==wt&&(t=this.compute()),Tt&&this.manager.element.style&&Xe[t]&&(this.manager.element.style[At]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return B(this.manager.recognizers,function(r){Ie(r.options.enable,[r])&&(t=t.concat(r.getTouchAction()))}),function Ot(t){if(Z(t,ue))return ue;var r=Z(t,He),a=Z(t,Pe);return r&&a?ue:r||a?r?He:Pe:Z(t,gt)?gt:"auto"}(t.join(" "))},preventDefaults:function(t){var r=t.srcEvent,a=t.offsetDirection;if(!this.manager.session.prevented){var l=this.actions,u=Z(l,ue)&&!Xe[ue],d=Z(l,Pe)&&!Xe[Pe],C=Z(l,He)&&!Xe[He];if(u&&1===t.pointers.length&&t.distance<2&&t.deltaTime<250)return;return C&&d||!(u||d&&a&L||C&&a&G)?void 0:this.preventSrc(r)}r.preventDefault()},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ze=1,Q=32;function J(t){this.options=W({},this.defaults,t||{}),this.id=function nt(){return rt++}(),this.manager=null,this.options.enable=Fe(this.options.enable,!0),this.state=Ze,this.simultaneous={},this.requireFail=[]}function Et(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function St(t){return t==Me?"down":t==_e?"up":t==_?"left":t==he?"right":""}function Ge(t,r){var a=r.manager;return a?a.get(t):t}function Y(){J.apply(this,arguments)}function je(){Y.apply(this,arguments),this.pX=null,this.pY=null}function dt(){Y.apply(this,arguments)}function ft(){J.apply(this,arguments),this._timer=null,this._input=null}function vt(){Y.apply(this,arguments)}function xt(){Y.apply(this,arguments)}function qe(){J.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ge(t,r){return(r=r||{}).recognizers=Fe(r.recognizers,ge.defaults.preset),new Ct(t,r)}function Ct(t,r){this.options=W({},ge.defaults,r||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=function n(t){return new(t.options.inputClass||(ot?ze:st?j:Se?ut:le))(t,s)}(this),this.touchAction=new mt(this,this.options.touchAction),Rt(this,!0),B(this.options.recognizers,function(a){var l=this.add(new a[0](a[1]));a[2]&&l.recognizeWith(a[2]),a[3]&&l.requireFailure(a[3])},this)}function Rt(t,r){var l,a=t.element;a.style&&(B(t.options.cssProps,function(u,d){l=Ee(a.style,d),r?(t.oldCssProps[l]=a.style[l],a.style[l]=u):a.style[l]=t.oldCssProps[l]||""}),r||(t.oldCssProps={}))}J.prototype={defaults:{},set:function(t){return W(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(te(t,"recognizeWith",this))return this;var r=this.simultaneous;return r[(t=Ge(t,this)).id]||(r[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return te(t,"dropRecognizeWith",this)||(t=Ge(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(te(t,"requireFailure",this))return this;var r=this.requireFail;return-1===ie(r,t=Ge(t,this))&&(r.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(te(t,"dropRequireFailure",this))return this;t=Ge(t,this);var r=ie(this.requireFail,t);return r>-1&&this.requireFail.splice(r,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var r=this,a=this.state;function l(u){r.manager.emit(u,t)}a<8&&l(r.options.event+Et(a)),l(r.options.event),t.additionalEvent&&l(t.additionalEvent),a>=8&&l(r.options.event+Et(a))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Q},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Q|Ze)))return!1;t++}return!0},recognize:function(t){var r=W({},t);if(!Ie(this.options.enable,[this,r]))return this.reset(),void(this.state=Q);56&this.state&&(this.state=Ze),this.state=this.process(r),30&this.state&&this.tryEmit(r)},process:function(t){},getTouchAction:function(){},reset:function(){}},P(Y,J,{defaults:{pointers:1},attrTest:function(t){var r=this.options.pointers;return 0===r||t.pointers.length===r},process:function(t){var r=this.state,a=t.eventType,l=6&r,u=this.attrTest(t);return l&&(a&y||!u)?16|r:l||u?a&I?8|r:2&r?4|r:2:Q}}),P(je,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:h},getTouchAction:function(){var t=this.options.direction,r=[];return t&L&&r.push(Pe),t&G&&r.push(He),r},directionTest:function(t){var r=this.options,a=!0,l=t.distance,u=t.direction,d=t.deltaX,C=t.deltaY;return u&r.direction||(r.direction&L?(u=0===d?Ce:d<0?_:he,a=d!=this.pX,l=Math.abs(t.deltaX)):(u=0===C?Ce:C<0?_e:Me,a=C!=this.pY,l=Math.abs(t.deltaY))),t.direction=u,a&&l>r.threshold&&u&r.direction},attrTest:function(t){return Y.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var r=St(t.direction);r&&(t.additionalEvent=this.options.event+r),this._super.emit.call(this,t)}}),P(dt,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ue]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){1!==t.scale&&(t.additionalEvent=this.options.event+(t.scale<1?"in":"out")),this._super.emit.call(this,t)}}),P(ft,J,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var r=this.options,a=t.pointers.length===r.pointers,l=t.distance<r.threshold,u=t.deltaTime>r.time;if(this._input=t,!l||!a||t.eventType&(I|y)&&!u)this.reset();else if(t.eventType&U)this.reset(),this._timer=we(function(){this.state=8,this.tryEmit()},r.time,this);else if(t.eventType&I)return 8;return Q},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&t.eventType&I?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=Te(),this.manager.emit(this.options.event,this._input)))}}),P(vt,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ue]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),P(xt,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:L|G,pointers:1},getTouchAction:function(){return je.prototype.getTouchAction.call(this)},attrTest:function(t){var a,r=this.options.direction;return r&(L|G)?a=t.overallVelocity:r&L?a=t.overallVelocityX:r&G&&(a=t.overallVelocityY),this._super.attrTest.call(this,t)&&r&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&X(a)>this.options.velocity&&t.eventType&I},emit:function(t){var r=St(t.offsetDirection);r&&this.manager.emit(this.options.event+r,t),this.manager.emit(this.options.event,t)}}),P(qe,J,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[gt]},process:function(t){var r=this.options,a=t.pointers.length===r.pointers,l=t.distance<r.threshold,u=t.deltaTime<r.time;if(this.reset(),t.eventType&U&&0===this.count)return this.failTimeout();if(l&&u&&a){if(t.eventType!=I)return this.failTimeout();var d=!this.pTime||t.timeStamp-this.pTime<r.interval,C=!this.pCenter||T(this.pCenter,t.center)<r.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,C&&d?this.count+=1:this.count=1,this._input=t,0==this.count%r.taps)return this.hasRequireFailures()?(this._timer=we(function(){this.state=8,this.tryEmit()},r.interval,this),2):8}return Q},failTimeout:function(){return this._timer=we(function(){this.state=Q},this.options.interval,this),Q},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ge.VERSION="2.0.7",ge.defaults={domEvents:!1,touchAction:wt,enable:!0,inputTarget:null,inputClass:null,preset:[[vt,{enable:!1}],[dt,{enable:!1},["rotate"]],[xt,{direction:L}],[je,{direction:L},["swipe"]],[qe],[qe,{event:"doubletap",taps:2},["tap"]],[ft]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ct.prototype={set:function(t){return W(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var r=this.session;if(!r.stopped){this.touchAction.preventDefaults(t);var a,l=this.recognizers,u=r.curRecognizer;(!u||u&&8&u.state)&&(u=r.curRecognizer=null);for(var d=0;d<l.length;)a=l[d],2===r.stopped||u&&a!=u&&!a.canRecognizeWith(u)?a.reset():a.recognize(t),!u&&14&a.state&&(u=r.curRecognizer=a),d++}},get:function(t){if(t instanceof J)return t;for(var r=this.recognizers,a=0;a<r.length;a++)if(r[a].options.event==t)return r[a];return null},add:function(t){if(te(t,"add",this))return this;var r=this.get(t.options.event);return r&&this.remove(r),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(te(t,"remove",this))return this;if(t=this.get(t)){var r=this.recognizers,a=ie(r,t);-1!==a&&(r.splice(a,1),this.touchAction.update())}return this},on:function(t,r){if(t!==E&&r!==E){var a=this.handlers;return B(ve(t),function(l){a[l]=a[l]||[],a[l].push(r)}),this}},off:function(t,r){if(t!==E){var a=this.handlers;return B(ve(t),function(l){r?a[l]&&a[l].splice(ie(a[l],r),1):delete a[l]}),this}},emit:function(t,r){this.options.domEvents&&function Nt(t,r){var a=o.createEvent("Event");a.initEvent(t,!0,!0),a.gesture=r,r.target.dispatchEvent(a)}(t,r);var a=this.handlers[t]&&this.handlers[t].slice();if(a&&a.length){r.type=t,r.preventDefault=function(){r.srcEvent.preventDefault()};for(var l=0;l<a.length;)a[l](r),l++}},destroy:function(){this.element&&Rt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},W(ge,{INPUT_START:U,INPUT_MOVE:2,INPUT_END:I,INPUT_CANCEL:y,STATE_POSSIBLE:Ze,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Q,DIRECTION_NONE:Ce,DIRECTION_LEFT:_,DIRECTION_RIGHT:he,DIRECTION_UP:_e,DIRECTION_DOWN:Me,DIRECTION_HORIZONTAL:L,DIRECTION_VERTICAL:G,DIRECTION_ALL:h,Manager:Ct,Input:i,TouchAction:mt,TouchInput:j,MouseInput:le,PointerEventInput:ze,TouchMouseInput:ut,SingleTouchInput:pe,Recognizer:J,AttrRecognizer:Y,Tap:qe,Pan:je,Swipe:xt,Pinch:dt,Rotate:vt,Press:ft,on:de,off:fe,each:B,merge:tt,extend:De,assign:W,inherit:P,bindFn:me,prefixed:Ee}),(typeof w<"u"?w:typeof self<"u"?self:{}).Hammer=ge,($=function(){return ge}.call(Ae,A,Ae,Ke))!==E&&(Ke.exports=$)}(window,document)}}]);